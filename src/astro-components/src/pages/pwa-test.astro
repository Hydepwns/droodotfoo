---
// Test page for PWA Astro components
import PWAInstall from '../components/PWAInstall.astro';
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>PWA Test</title>
  </head>
  <body>
    <div class="test-container">
      <h1>PWA Astro Component Test</h1>
      
      <div class="test-section">
        <h2>Default PWA Install Component</h2>
        <PWAInstall />
      </div>
      
      <div class="test-section">
        <h2>Minimal Theme</h2>
        <PWAInstall theme="minimal" position="top-left" />
      </div>
      
      <div class="test-section">
        <h2>Banner Style</h2>
        <PWAInstall theme="banner" position="center" />
      </div>
      
      <div class="test-section">
        <h2>Custom Text</h2>
        <PWAInstall 
          customText={{
            install: "Add to Home Screen",
            update: "New Version Available",
            installed: "Added Successfully!"
          }}
        />
      </div>
      
      <div class="test-controls">
        <h3>Test Controls</h3>
        <button onclick="triggerInstall()">Trigger Install</button>
        <button onclick="triggerUpdate()">Trigger Update</button>
        <button onclick="clearCaches()">Clear Caches</button>
        <button onclick="getStatus()">Get Status</button>
      </div>
      
      <div class="test-info">
        <h3>PWA Status</h3>
        <div id="pwa-status-display">
          <p>Status will appear here...</p>
        </div>
      </div>
    </div>
    
    <script>
      function triggerInstall() {
        const event = new CustomEvent('phx:pwa_command', {
          detail: { command: { type: 'install' } }
        });
        document.dispatchEvent(event);
      }
      
      function triggerUpdate() {
        const event = new CustomEvent('phx:pwa_command', {
          detail: { command: { type: 'update' } }
        });
        document.dispatchEvent(event);
      }
      
      function clearCaches() {
        const event = new CustomEvent('phx:pwa_command', {
          detail: { command: { type: 'clear_cache' } }
        });
        document.dispatchEvent(event);
      }
      
      function getStatus() {
        const event = new CustomEvent('phx:pwa_command', {
          detail: { command: { type: 'get_status' } }
        });
        document.dispatchEvent(event);
      }
      
      // Listen for PWA events
      window.addEventListener('pwa-install-available', (event) => {
        console.log('Install available:', event.detail);
        updateStatusDisplay('Install available');
      });
      
      window.addEventListener('pwa-installed', (event) => {
        console.log('App installed:', event.detail);
        updateStatusDisplay('App installed');
      });
      
      window.addEventListener('pwa-update-available', (event) => {
        console.log('Update available:', event.detail);
        updateStatusDisplay('Update available');
      });
      
      window.addEventListener('pwa-status-changed', (event) => {
        console.log('Status changed:', event.detail);
        updateStatusDisplay('Status changed: ' + JSON.stringify(event.detail));
      });
      
      function updateStatusDisplay(message) {
        const display = document.getElementById('pwa-status-display');
        if (display) {
          display.innerHTML = `<p>${message}</p>`;
        }
      }
    </script>
    
    <style>
      .test-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        font-family: system-ui, sans-serif;
      }
      
      .test-section {
        margin: 2rem 0;
        padding: 1rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        min-height: 100px;
      }
      
      .test-section h2 {
        margin-top: 0;
      }
      
      .test-controls {
        margin: 2rem 0;
        padding: 1rem;
        background: #f5f5f5;
        border-radius: 8px;
      }
      
      .test-controls button {
        margin: 0.5rem;
        padding: 0.5rem 1rem;
        background: #007acc;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      
      .test-controls button:hover {
        background: #005a9e;
      }
      
      .test-info {
        margin: 2rem 0;
        padding: 1rem;
        background: #e8f4fd;
        border-radius: 8px;
      }
      
      #pwa-status-display {
        background: white;
        padding: 1rem;
        border-radius: 4px;
        border: 1px solid #ddd;
      }
    </style>
  </body>
</html>
