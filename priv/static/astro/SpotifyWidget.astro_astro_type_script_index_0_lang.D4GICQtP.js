import{a as Q,r as v,c as ee,R as te}from"./client.CJO0MmSH.js";var U={exports:{}},R={},q;function oe(){if(q)return R;q=1;/**
 * @license React
 * react-jsx-dev-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return(function(){function f(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===B?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case N:return"Fragment";case P:return"Profiler";case x:return"StrictMode";case r:return"Suspense";case c:return"SuspenseList";case X:return"Activity"}if(typeof e=="object")switch(typeof e.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),e.$$typeof){case j:return"Portal";case C:return e.displayName||"Context";case W:return(e._context.displayName||"Context")+".Consumer";case A:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case s:return t=e.displayName||null,t!==null?t:f(e.type)||"Memo";case h:t=e._payload,e=e._init;try{return f(e(t))}catch{}}return null}function o(e){return""+e}function i(e){try{o(e);var t=!1}catch{t=!0}if(t){t=console;var l=t.error,p=typeof Symbol=="function"&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return l.call(t,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",p),o(e)}}function a(e){if(e===N)return"<>";if(typeof e=="object"&&e!==null&&e.$$typeof===h)return"<...>";try{var t=f(e);return t?"<"+t+">":"<...>"}catch{return"<...>"}}function O(){var e=I.A;return e===null?null:e.getOwner()}function _(){return Error("react-stack-top-frame")}function w(e){if(Y.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return e.key!==void 0}function u(e,t){function l(){M||(M=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",t))}l.isReactWarning=!0,Object.defineProperty(e,"key",{get:l,configurable:!0})}function g(){var e=f(this.type);return F[e]||(F[e]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),e=this.props.ref,e!==void 0?e:null}function m(e,t,l,p,y,L){var d=l.ref;return e={$$typeof:S,type:e,key:t,props:l,_owner:p},(d!==void 0?d:null)!==null?Object.defineProperty(e,"ref",{enumerable:!1,get:g}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:y}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:L}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}function k(e,t,l,p,y,L){var d=t.children;if(d!==void 0)if(p)if(G(d)){for(p=0;p<d.length;p++)D(d[p]);Object.freeze&&Object.freeze(d)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else D(d);if(Y.call(t,"key")){d=f(e);var E=Object.keys(t).filter(function(Z){return Z!=="key"});p=0<E.length?"{key: someKey, "+E.join(": ..., ")+": ...}":"{key: someKey}",z[d+p]||(E=0<E.length?"{"+E.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,p,d,E,d),z[d+p]=!0)}if(d=null,l!==void 0&&(i(l),d=""+l),w(t)&&(i(t.key),d=""+t.key),"key"in t){l={};for(var V in t)V!=="key"&&(l[V]=t[V])}else l=t;return d&&u(l,typeof e=="function"?e.displayName||e.name||"Unknown":e),m(e,d,l,O(),y,L)}function D(e){T(e)?e._store&&(e._store.validated=1):typeof e=="object"&&e!==null&&e.$$typeof===h&&(e._payload.status==="fulfilled"?T(e._payload.value)&&e._payload.value._store&&(e._payload.value._store.validated=1):e._store&&(e._store.validated=1))}function T(e){return typeof e=="object"&&e!==null&&e.$$typeof===S}var b=Q(),S=Symbol.for("react.transitional.element"),j=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),W=Symbol.for("react.consumer"),C=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),r=Symbol.for("react.suspense"),c=Symbol.for("react.suspense_list"),s=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),X=Symbol.for("react.activity"),B=Symbol.for("react.client.reference"),I=b.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y=Object.prototype.hasOwnProperty,G=Array.isArray,$=console.createTask?console.createTask:function(){return null};b={react_stack_bottom_frame:function(e){return e()}};var M,F={},J=b.react_stack_bottom_frame.bind(b,_)(),H=$(a(_)),z={};R.Fragment=N,R.jsxDEV=function(e,t,l,p){var y=1e4>I.recentlyCreatedOwnerStacks++;return k(e,t,l,p,y?Error("react-stack-top-frame"):J,y?$(a(e)):H)}})(),R}var K;function re(){return K||(K=1,U.exports=oe()),U.exports}var n=re();function se({playlistId:f="",theme:o="gradient",autoPlay:i=!1,showVolume:a=!0,showProgress:O=!0,onTrackChange:_,onStateChange:w}){const[u,g]=v.useState({state:"idle",player:null,deviceId:null,currentTrack:null,isPaused:!0,position:0,duration:0,volume:50,error:null}),m=v.useRef(null),k=v.useCallback(async()=>{window.Spotify||await D();const r=await T();if(!r){g(s=>({...s,state:"error",error:"No access token available"}));return}const c=new window.Spotify.Player({name:"Droo.foo Spotify Widget",getOAuthToken:s=>s(r),volume:.5});c.addListener("ready",({device_id:s})=>{g(h=>({...h,state:"ready",deviceId:s}))}),c.addListener("player_state_changed",s=>{s&&(g(h=>({...h,state:"playing",currentTrack:s.track_window.current_track,isPaused:s.paused,position:s.position,duration:s.duration})),_?.(s.track_window.current_track),w?.(s))}),c.addListener("initialization_error",({message:s})=>{g(h=>({...h,state:"error",error:s}))}),await c.connect(),m.current=c,g(s=>({...s,player:c}))},[_,w]),D=()=>new Promise(r=>{if(window.Spotify){r();return}const c=document.createElement("script");c.src="https://sdk.scdn.co/spotify-player.js",c.async=!0,window.onSpotifyWebPlaybackSDKReady=()=>r(),document.body.appendChild(c)}),T=async()=>{try{return(await(await fetch("/api/spotify/token")).json()).token}catch(r){return console.error("Failed to get access token:",r),null}},b=v.useCallback(()=>{m.current&&m.current.resume()},[]),S=v.useCallback(()=>{m.current&&m.current.pause()},[]),j=v.useCallback(()=>{m.current&&m.current.nextTrack()},[]),N=v.useCallback(()=>{m.current&&m.current.previousTrack()},[]),x=v.useCallback(r=>{m.current&&m.current.seek(r)},[]),P=v.useCallback(r=>{m.current&&(m.current.setVolume(r/100),g(c=>({...c,volume:r})))},[]),W=v.useCallback(r=>{const c=r.currentTarget.getBoundingClientRect(),s=(r.clientX-c.left)/c.width,h=Math.round(s*u.duration);x(h)},[u.duration,x]),C=r=>{const c=Math.floor(r/1e3),s=Math.floor(c/60),h=c%60;return`${s}:${h.toString().padStart(2,"0")}`};v.useEffect(()=>{g(r=>({...r,state:"loading"})),k()},[k]),v.useEffect(()=>()=>{m.current&&m.current.disconnect()},[]);const A=()=>{switch(u.state){case"loading":return n.jsxDEV("div",{className:"spotify-widget__loading",children:"Initializing Spotify Player..."},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:234,columnNumber:11},this);case"error":return n.jsxDEV("div",{className:"spotify-widget__error",children:["Error: ",u.error]},void 0,!0,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:241,columnNumber:11},this);case"ready":case"playing":return n.jsxDEV(n.Fragment,{children:[u.currentTrack?n.jsxDEV("div",{className:"spotify-widget__track-info",children:[n.jsxDEV("div",{className:"spotify-widget__track-name",children:u.currentTrack.name},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:252,columnNumber:17},this),n.jsxDEV("div",{className:"spotify-widget__artist-name",children:u.currentTrack.artists.map(r=>r.name).join(", ")},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:255,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:251,columnNumber:15},this):n.jsxDEV("div",{className:"spotify-widget__track-info",children:"No track selected"},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:260,columnNumber:15},this),n.jsxDEV("div",{className:"spotify-widget__controls",children:[n.jsxDEV("button",{className:"spotify-widget__button",onClick:N,"aria-label":"Previous track",children:"⏮"},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:266,columnNumber:15},this),n.jsxDEV("button",{className:"spotify-widget__button spotify-widget__button--play-pause",onClick:u.isPaused?b:S,"aria-label":u.isPaused?"Play":"Pause",children:u.isPaused?"▶":"⏸"},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:273,columnNumber:15},this),n.jsxDEV("button",{className:"spotify-widget__button",onClick:j,"aria-label":"Next track",children:"⏭"},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:280,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:265,columnNumber:13},this),O&&u.currentTrack&&n.jsxDEV("div",{className:"spotify-widget__progress-container",children:[n.jsxDEV("div",{className:"spotify-widget__progress-bar",onClick:W,children:n.jsxDEV("div",{className:"spotify-widget__progress-fill",style:{width:`${u.position/u.duration*100}%`}},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:295,columnNumber:19},this)},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:291,columnNumber:17},this),n.jsxDEV("div",{className:"spotify-widget__time-info",children:[n.jsxDEV("span",{children:C(u.position)},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:301,columnNumber:19},this),n.jsxDEV("span",{children:C(u.duration)},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:302,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:300,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:290,columnNumber:15},this),a&&n.jsxDEV("div",{className:"spotify-widget__volume-control",children:[n.jsxDEV("span",{children:"🔊"},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:309,columnNumber:17},this),n.jsxDEV("input",{type:"range",min:"0",max:"100",value:u.volume,onChange:r=>P(parseInt(r.target.value)),className:"spotify-widget__volume-slider"},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:310,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:308,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:249,columnNumber:11},this);default:return n.jsxDEV("div",{children:"Widget not initialized"},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:324,columnNumber:16},this)}};return n.jsxDEV("div",{className:"spotify-widget__container",children:A()},void 0,!1,{fileName:"/Users/droo/Documents/CODE/droodotfoo/src/astro-components/src/components/SpotifyWidget.tsx",lineNumber:329,columnNumber:5},this)}class ne{container=null;root=null;options;eventListeners=new Map;constructor(o){this.options=o,this.setupEventListeners()}setupEventListeners(){document.addEventListener("phx:spotify_command",o=>{this.handleSpotifyCommand(o.detail)}),document.addEventListener("phx:spotify_auth",o=>{this.handleAuthEvent(o.detail)})}handleSpotifyCommand(o){const{command:i}=o;switch(i.type){case"play":this.dispatchToWidget("play");break;case"pause":this.dispatchToWidget("pause");break;case"next":this.dispatchToWidget("next");break;case"previous":this.dispatchToWidget("previous");break;case"seek":this.dispatchToWidget("seek",{position:i.position});break;case"volume":this.dispatchToWidget("volume",{level:i.level});break;case"load_playlist":this.dispatchToWidget("loadPlaylist",{id:i.playlistId});break;default:console.warn("Unknown Spotify command:",i.type)}}handleAuthEvent(o){const{action:i}=o;switch(i){case"authenticate":this.handleAuthentication();break;case"logout":this.handleLogout();break;default:console.warn("Unknown auth action:",i)}}dispatchToWidget(o,i){const a=new CustomEvent(`spotify-${o}`,{detail:i});document.dispatchEvent(a)}handleAuthentication(){window.location.href="/auth/spotify"}handleLogout(){localStorage.removeItem("spotify_token"),this.dispatchToWidget("logout")}initializeWidget(o,i={}){this.container=o,this.root=ee.createRoot(o),this.root.render(te.createElement(se,{...i,onTrackChange:a=>{this.handleTrackChange(a)},onStateChange:a=>{this.handleStateChange(a)}})),this.setupWidgetEventListeners()}setupWidgetEventListeners(){document.addEventListener("spotify-play",()=>{this.sendToLiveView("play")}),document.addEventListener("spotify-pause",()=>{this.sendToLiveView("pause")}),document.addEventListener("spotify-next",()=>{this.sendToLiveView("next")}),document.addEventListener("spotify-previous",()=>{this.sendToLiveView("previous")}),document.addEventListener("spotify-seek",o=>{this.sendToLiveView("seek",{position:o.detail.position})}),document.addEventListener("spotify-volume",o=>{this.sendToLiveView("volume",{level:o.detail.level})})}handleTrackChange(o){this.options.onTrackChange&&this.options.onTrackChange(o),this.sendToLiveView("track_changed",{track:o})}handleStateChange(o){this.options.onStateChange&&this.options.onStateChange(o),this.sendToLiveView("state_changed",{state:o})}sendToLiveView(o,i){const a=new CustomEvent(`phx:${o}`,{detail:i});document.dispatchEvent(a)}destroy(){this.root&&(this.root.unmount(),this.root=null),this.eventListeners.forEach((o,i)=>{document.removeEventListener(i,o)}),this.eventListeners.clear()}}document.addEventListener("DOMContentLoaded",()=>{const f=document.getElementById("spotify-widget-container");if(f){const o=f.querySelector("#spotify-react-root");o&&(new ne({containerId:"spotify-react-root",onTrackChange:a=>{console.log("Track changed:",a),window.dispatchEvent(new CustomEvent("spotify-track-changed",{detail:a}))},onStateChange:a=>{console.log("State changed:",a),window.dispatchEvent(new CustomEvent("spotify-state-changed",{detail:a}))},onError:a=>{console.error("Spotify error:",a),window.dispatchEvent(new CustomEvent("spotify-error",{detail:{error:a}}))}}).initializeWidget(o,{playlistId:f.dataset.playlistId||"",theme:f.dataset.theme||"gradient",autoPlay:f.dataset.autoPlay==="true",showVolume:f.dataset.showVolume==="true",showProgress:f.dataset.showProgress==="true"}),console.log("Spotify Widget initialized with bridge"))}});
